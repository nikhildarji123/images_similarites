<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Facial Similarity Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="max-w-4xl mx-auto mt-10 p-6 bg-white shadow-lg rounded-lg">
      <h1 class="text-3xl font-bold text-center text-blue-500 mb-6">
        Facial Similarity Analysis
      </h1>
      <form id="uploadForm" enctype="multipart/form-data" class="space-y-6">
        <div class="flex flex-col">
          <label for="image1" class="text-lg font-semibold text-gray-700"
            >Select First Image:</label
          >
          <input
            type="file"
            id="image1"
            name="image1"
            accept="image/*"
            required
            class="mt-2 p-2 border rounded-lg border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
        </div>
        <div class="flex flex-col">
          <label for="image2" class="text-lg font-semibold text-gray-700"
            >Select Second Image:</label
          >
          <input
            type="file"
            id="image2"
            name="image2"
            accept="image/*"
            required
            class="mt-2 p-2 border rounded-lg border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400"
          />
        </div>
        <button
          type="submit"
          class="w-full py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400 text-lg font-semibold"
        >
          Analyze
        </button>
      </form>

      <div class="results mt-10">
        <h2 class="text-2xl font-bold text-blue-500 text-center mb-4">
          Results
        </h2>
        <div id="similarity" class="text-gray-700"></div>
        <div id="images" class="flex flex-wrap justify-center gap-4 mt-4"></div>
      </div>
    </div>

    <script>
      document.getElementById("uploadForm").onsubmit = async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const response = await fetch("/upload", {
          method: "POST",
          body: formData,
        });

        const similarityDiv = document.getElementById("similarity");
        const imagesDiv = document.getElementById("images");

        if (response.ok) {
          const result = await response.json();
          similarityDiv.innerHTML = `
                    <p><strong class='font-semibold'>Accuracy:</strong> ${
                      result.accuracy
                    }%</p>
                    <p><strong class='font-semibold'>Similarity Result:</strong> ${
                      result.similarity_result
                    }</p>
                    <p><strong class='font-semibold'>Feature-Wise Similarities:</strong></p>
                    <ul class='list-disc list-inside'>${Object.entries(
                      result.feature_similarities
                    )
                      .map(([k, v]) => `<li>${k}: ${v}</li>`)
                      .join("")}</ul>
                `;
          imagesDiv.innerHTML = `
                    <img src="/outputs/${result.annotated1}" alt="Annotated Image 1" class="w-1/2 rounded-lg shadow-md">
                    <img src="/outputs/${result.annotated2}" alt="Annotated Image 2" class="w-1/2 rounded-lg shadow-md">
                `;
        } else {
          const error = await response.json();
          similarityDiv.innerHTML = `<span class='text-red-500 font-semibold'>Error:</span> ${error.detail}`;
          imagesDiv.innerHTML = ""; // Clear images on error
        }
      };
    </script>
  </body>
</html>
